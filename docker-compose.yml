services:
  scramjet:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: scramjet-wisp
    restart: unless-stopped
    user: node

    # Hardening
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true

    # Resources
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1024M

    environment:
      - NODE_ENV=production
      - PORT=8080
      - WISP_PATH=/wisp/
      - DEFAULT_SEARCH_TEMPLATE=https://www.google.com/search?q=%s
      - DEFAULT_TRANSPORT=/epoxy/index.mjs
      - WISP_DNS=1.1.1.3,1.0.0.3

    # No 'ports:' section here. Coolify handles the routing.
    networks:
      - coolify

networks:
  coolify:
    external: true
